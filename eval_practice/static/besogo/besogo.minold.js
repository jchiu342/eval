(function(){function h(a,b){a.getAttribute("tabindex")||a.setAttribute("tabindex","0");a.addEventListener("keydown",function(a){a=a||window.event;switch(a.keyCode){case 33:b.prevNode(10);break;case 34:b.nextNode(10);break;case 35:b.nextNode(-1);break;case 36:b.prevNode(-1);break;case 37:b.prevNode(1);break;case 38:b.nextSibling(-1);break;case 39:b.nextNode(1);break;case 40:b.nextSibling(1);break;case 46:b.cutCurrent()}33<=a.keyCode&&40>=a.keyCode&&a.preventDefault()})}function k(a,b){a.addEventListener("wheel",
function(a){a=a||window.event;0<a.deltaY?(b.nextNode(1),a.preventDefault()):0>a.deltaY&&(b.prevNode(1),a.preventDefault())})}function f(a,b){var p;try{p=c.parseSgf(a)}catch(d){return}c.loadSgf(p,b)}function m(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4===d.readyState&&200===d.status&&(f(d.responseText,b),n(b,c))};d.overrideMimeType("text/plain");d.open("GET",a,!0);d.send()}function n(a,b){function c(b,d){var e;b=b.split(/\D+/);for(e=0;e<b.length;e++)b[e]&&(d?a.getCurrent().children.length&&
(a.nextNode(1),a.nextSibling(b[e]-1)):a.nextNode(+b[e]))}var d,e,l;b=b.split(/[Nn]+/);for(e=0;e<b.length;e++)for(d=b[e].split(/[Bb]+/),c(d[0],!1),l=1;l<d.length;l++)c(d[l],!0)}var c=window.besogo=window.besogo||{};c.VERSION="0.0.2-alpha";c.create=function(a,b){function p(b,d){d&&b>d?(a.style["flex-direction"]="row",l.style.height=d+"px",l.style.width=d+"px",g&&(g.style.height=d+"px",g.style.width=b-d+"px")):(a.style["flex-direction"]="column",l.style.height=b+"px",l.style.width=b+"px",g&&(d&&(g.style.height=
d-b+"px"),g.style.width=b+"px"))}function d(b,d){var g=document.createElement("div");b&&(g.className=b);d=d||a;d.appendChild(g);return g}var e,l,g,u={control:c.makeControlPanel,names:c.makeNamesPanel,comment:c.makeCommentPanel,tool:c.makeToolPanel,tree:c.makeTreePanel,file:c.makeFilePanel},q=a.textContent||a.innerText||"",w;a.className+=" besogo-container";b=b||{};b.size=c.parseSize(b.size||19);b.coord=b.coord||"none";b.tool=b.tool||"auto";""===b.panels&&(b.panels=[]);b.panels=b.panels||"control+names+comment+tool+tree+file";
"string"===typeof b.panels&&(b.panels=b.panels.split("+"));b.path=b.path||"";void 0===b.shadows?b.shadows="auto":"off"===b.shadows&&(b.shadows=!1);e=c.makeEditor(b.size.x,b.size.y);e.setTool(b.tool);e.setCoordStyle(b.coord);b.realstones?(e.REAL_STONES=!0,e.SHADOWS=b.shadows):e.SHADOWS=b.shadows&&"auto"!==b.shadows;b.nokeys||h(a,e);if(b.sgf)try{m(b.sgf,e,b.path)}catch(v){}else q.match(/\s*\(\s*;/)&&(f(q,e),n(e,b.path));for("number"!==typeof b.variants&&"string"!==typeof b.variants||e.setVariantStyle(+b.variants);a.firstChild;)a.removeChild(a.firstChild);
l=d("besogo-board");c.makeBoardDisplay(l,e);b.nowheel||k(l,e);if(0<b.panels.length){g=d("besogo-panels");for(q=0;q<b.panels.length;q++)if(w=b.panels[q],u[w])u[w](d("besogo-"+w,g),e);g.firstChild||(a.removeChild(g),g=!1)}b.resize=b.resize||"auto";"auto"===b.resize?(e=function(){var d=window.innerHeight,e=parseFloat(getComputedStyle(a.parentElement).width),c=+(b.maxwidth||-1),l=b.orient||"auto",q=+(b.portratio||200)/100,k=+(b.landratio||200)/100,f=+(b.minpanelswidth||350),h=+(b.minpanelsheight||400),
w=+(b.transwidth||600),e=0<c&&c<e?c:e,m;"portrait"!==l&&"landscape"!==l&&(l=e<w||"view"===l&&e<d?"portrait":"landscape");"portrait"===l?isNaN(q)||(m=q*e,g&&(m=m-e<h?e+h:m)):"landscape"===l&&(m=g?isNaN(k)?d:e/k:e,g&&(m=e<m+f?e-f:m));p(e,m);a.style.width=e+"px"},window.addEventListener("resize",e),e()):"fixed"===b.resize&&p(a.clientWidth,a.clientHeight)};c.parseSize=function(a){var b,c;a=(a+"").replace(/\s/g,"");(b=a.match(/^(\d+):(\d+)$/))?(c=+b[1],a=+b[2]):a.match(/^\d+$/)?(c=+a,a=+a):c=a=19;if(52<
c||1>c||52<a||1>a)c=a=19;return{x:c,y:a}};c.autoInit=function(){function a(b,a){return-1!==b.className.split(" ").indexOf(a)}var b=document.getElementsByTagName("div"),p=[],d,e,l;for(d=0;d<b.length;d++)(a(b[d],"besogo-editor")||a(b[d],"besogo-viewer")||a(b[d],"besogo-diagram"))&&!a(b[d],"besogo-container")&&p.push(b[d]);for(d=0;d<p.length;d++){b={};a(p[d],"besogo-editor")?(b.panels="control names comment tool tree file".split(" "),b.tool="auto"):a(p[d],"besogo-viewer")?(b.panels=["control","names",
"comment"],b.tool="navOnly"):a(p[d],"besogo-diagram")&&(b.panels=[],b.tool="navOnly");l=p[d].attributes;for(e=0;e<l.length;e++)b[l[e].name]=l[e].value;c.create(p[d],b)}}})();
besogo.makeBoardDisplay=function(h,k){function f(){C=!0;A=[];x.removeChild(B);h.removeEventListener("touchstart",f)}function m(d){var e,g,l="";v=("none"===d?0:75)+6;e=2*v+88*t;g=2*v+88*r;x=besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"0 0 "+e+" "+g});x.appendChild(besogo.svgEl("rect",{width:e,height:g,"class":"besogo-svg-board"}));x.appendChild(besogo.svgEl("rect",{width:88*(t-1),height:88*(r-1),x:q(1),y:q(1),"class":"besogo-svg-lines"}));for(e=2;e<=r-1;e++)l+="M"+q(1)+","+q(e)+"h"+88*(t-
1);for(e=2;e<=t-1;e++)l+="M"+q(e)+","+q(1)+"v"+88*(r-1);x.appendChild(besogo.svgEl("path",{d:l,"class":"besogo-svg-lines"}));c();"none"!==d&&n(d);D=besogo.svgEl("g");y=besogo.svgEl("g");x.appendChild(D);x.appendChild(y);C||(B=besogo.svgEl("g"),x.appendChild(B));for(l=1;l<=t;l++)for(e=1;e<=r;e++)d=besogo.svgEl("rect",{x:q(l)-44,y:q(e)-44,width:88,height:88,opacity:0}),d.addEventListener("click",a(l,e)),C||(d.addEventListener("mouseover",b(l,e)),d.addEventListener("mouseout",p(l,e))),x.appendChild(d);
if(k.REAL_STONES)for(d=besogo.BLACK_STONES*besogo.WHITE_STONES,E=[],l=1;l<=t;l++)for(e=1;e<=r;e++)E[w(l,e)]=Math.floor(Math.random()*d)}function n(b){function a(b,d,e){b=besogo.svgEl("text",{x:b,y:d,dy:".65ex","font-size":32,"text-anchor":"middle","font-family":"Helvetica, Arial, sans-serif",fill:"black"});b.appendChild(document.createTextNode(e));x.appendChild(b)}b=besogo.coord[b](t,r);var d,e;for(d=1;d<=t;d++)e=q(d),a(e,q(1)-85,b.x[d]),a(e,q(r)+85,b.x[d]);for(d=1;d<=r;d++)e=q(d),a(q(1)-85,e,b.y[d]),
a(q(t)+85,e,b.y[d])}function c(){function b(d,a){e+="M"+q(d)+","+q(a)+"l0,0"}var d,a,e="";t%2&&r%2&&(d=(t-1)/2+1,a=(r-1)/2+1,b(d,a),17<=t&&17<=r&&(b(4,a),b(t-3,a),b(d,4),b(d,r-3)));11<=t&&11<=r?(b(4,4),b(4,r-3),b(t-3,4),b(t-3,r-3)):8<=t&&8<=r&&(b(3,3),b(3,r-2),b(t-2,3),b(t-2,r-2));e&&x.appendChild(besogo.svgEl("path",{d:e,"stroke-linecap":"round","class":"besogo-svg-hoshi"}))}function a(d,a){return function(e){k.click(d,a,e.ctrlKey,e.shiftKey);C||b(d,a)()}}function b(b,d){return function(){var a=
A[w(b,d)];a&&a.setAttribute("visibility","visible")}}function p(b,d){return function(){var a=A[w(b,d)];a&&a.setAttribute("visibility","hidden")}}function d(b){var a=besogo.svgEl("g"),d,e,g,c,l,p;k.SHADOWS&&(d=besogo.svgShadowGroup(),a.appendChild(d));for(e=1;e<=t;e++)for(g=1;g<=r;g++)if(p=b.getStone(e,g))c=q(e),l=q(g),k.REAL_STONES?a.appendChild(besogo.realStone(c,l,p,E[w(e,g)])):a.appendChild(besogo.svgStone(c,l,p)),k.SHADOWS&&(d.appendChild(besogo.svgShadow(c-2,l-4)),d.appendChild(besogo.svgShadow(c+
2,l+4)));x.replaceChild(a,D);D=a}function e(b){var a,d,e,c,p,f=besogo.svgEl("g"),h=b.move,m=k.getVariants(),n,u,v;z=[];for(d=1;d<=t;d++)for(e=1;e<=r;e++)if(n=b.getMarkup(d,e)){c=q(d);p=q(e);u=b.getStone(d,e);v=-1===u?"white":"black";h&&h.x===d&&h.y===e?v=g(m,b,d,e)?besogo.PURP:besogo.BLUE:g(m,b,d,e)&&(v=besogo.RED);if("number"===typeof n)switch(n){case 1:a=besogo.svgCircle(c,p,v);break;case 2:a=besogo.svgSquare(c,p,v);break;case 3:a=besogo.svgTriangle(c,p,v);break;case 4:a=besogo.svgCross(c,p,v);
break;case 5:a=besogo.svgBlock(c,p,v)}else u||(a=l(c,p),f.appendChild(a)),a=besogo.svgLabel(c,p,v,n);f.appendChild(a);z[w(d,e)]=a}h&&0!==h.x&&0!==h.y&&(d=h.x,e=h.y,z[w(d,e)]||(v=g(m,b,d,e)?besogo.PURP:besogo.BLUE,a=besogo.svgPlus(q(d),q(e),v),f.appendChild(a),z[w(d,e)]=a));for(d=0;d<m.length;d++)m[d]!==b&&(a=m[d].move)&&0!==a.x&&!z[w(a.x,a.y)]&&(p=b.getStone(a.x,a.y),e=q(a.x),c=q(a.y),p||(p=l(e,c),f.appendChild(p)),p=String.fromCharCode(65+d%26),p=besogo.svgLabel(e,c,besogo.LRED,p),f.appendChild(p),
z[w(a.x,a.y)]=p);x.replaceChild(f,y);y=f}function l(b,a){return besogo.svgEl("rect",{x:b-44,y:a-44,height:88,width:88,opacity:.85,stroke:"none","class":"besogo-svg-board"})}function g(b,a,d,e){var c,g;for(c=0;c<b.length;c++)if(b[c]!==a&&(g=b[c].move)&&g.x===d&&g.y===e)return!0;return!1}function u(b){if(!C){var a,d,e,c,g,l=besogo.svgEl("g"),p=k.getTool(),f,h;A=[];l.setAttribute("opacity","0.35");if("navOnly"===p)for(b=b.children,d=0;d<b.length;d++)(f=b[d].move)&&0!==f.x&&(c=q(f.x),g=q(f.y),a=besogo.svgStone(c,
g,f.color),a.setAttribute("visibility","hidden"),l.appendChild(a),A[w(f.x,f.y)]=a);else for(d=1;d<=t;d++)for(e=1;e<=r;e++){a=null;c=q(d);g=q(e);f=b.getStone(d,e);h=-1===f?"white":"black";switch(p){case "auto":a=besogo.svgStone(c,g,b.nextToMove);break;case "playB":a=besogo.svgStone(c,g,-1);break;case "playW":a=besogo.svgStone(c,g,1);break;case "addB":-1===f?a=besogo.svgCross(c,g,besogo.RED):(a=besogo.svgEl("g"),a.appendChild(besogo.svgStone(c,g,-1)),a.appendChild(besogo.svgPlus(c,g,besogo.RED)));break;
case "addW":1===f?a=besogo.svgCross(c,g,besogo.RED):(a=besogo.svgEl("g"),a.appendChild(besogo.svgStone(c,g,1)),a.appendChild(besogo.svgPlus(c,g,besogo.RED)));break;case "addE":f&&(a=besogo.svgCross(c,g,besogo.RED));break;case "circle":a=besogo.svgCircle(c,g,h);break;case "square":a=besogo.svgSquare(c,g,h);break;case "triangle":a=besogo.svgTriangle(c,g,h);break;case "cross":a=besogo.svgCross(c,g,h);break;case "block":a=besogo.svgBlock(c,g,h);break;case "label":a=besogo.svgLabel(c,g,h,k.getLabel())}a&&
(a.setAttribute("visibility","hidden"),l.appendChild(a),A[w(d,e)]=a)}x.replaceChild(l,B);B=l}}function q(b){return v+44+88*(b-1)}function w(b,a){return(b-1)*r+(a-1)}var v,t=k.getCurrent().getSize().x,r=k.getCurrent().getSize().y,x,D,y,B,z,A,E,C=!1;m(k.getCoordStyle());h.appendChild(x);k.addListener(function(b){var a=k.getCurrent(),c=a.getSize(),g=!1,l=x;if(c.x!==t||c.y!==r||b.coord)t=c.x,r=c.y,m(b.coord||k.getCoordStyle()),h.replaceChild(x,l),g=!0;g||b.navChange||b.stoneChange?(d(a),e(a),u(a)):b.markupChange?
(e(a),u(a)):(b.tool||b.label)&&u(a)});(function(b){d(b);e(b);u(b)})(k.getCurrent());h.addEventListener("touchstart",f)};
besogo.makeCommentPanel=function(h,k){function f(d){var f;if(d.navChange){f=k.getCurrent().comment||"";var q=b;f=document.createTextNode(f);q.replaceChild(f,n.C);n.C=f;k.getCurrent()===k.getRoot()&&c.firstChild&&"none"===a.style.display?c.style.display="table":c.style.display="none";p.style.display="none";b.style.display="block"}else void 0!==d.comment&&(q=b,f=document.createTextNode(d.comment),q.replaceChild(f,n.C),n.C=f,p.value=d.comment);if(d.gameInfo){q=d.gameInfo;f=document.createElement("table");
var w,v,t,r;f.className="besogo-gameInfo";for(w=0;w<e.length;w++)v=e[w],q[v]&&(t=document.createElement("tr"),f.appendChild(t),r=document.createElement("td"),r.appendChild(document.createTextNode(l[v])),t.appendChild(r),r=document.createElement("td"),v=document.createTextNode(q[v]),r.appendChild(v),t.appendChild(r));f.firstChild&&"none"!==c.style.display||(f.style.display="none");h.replaceChild(f,c);c=f;m(d.gameInfo)}}function m(b){var c=document.createElement("table"),p=d.concat(e),f,m,n,r,x;c.className=
"besogo-gameInfo";for(f=0;f<p.length;f++)m=p[f],n=document.createElement("tr"),c.appendChild(n),r=document.createElement("td"),r.appendChild(document.createTextNode(l[m])),n.appendChild(r),r=document.createElement("td"),x=document.createElement("input"),b[m]&&(x.value=b[m]),x.onblur=function(b,a){return function(){k.setGameInfo(b.value,a)}}(x,m),x.addEventListener("keydown",function(b){b=b||window.event;b.stopPropagation()}),r.appendChild(x),n.appendChild(r);"none"===a.style.display&&(c.style.display=
"none");h.replaceChild(c,a);a=c}var n={},c=document.createElement("table"),a=document.createElement("table"),b=document.createElement("div"),p=document.createElement("textarea"),d="PW WR WT PB BR BT".split(" "),e="HA KM RU TM OT GN EV PC RO DT RE ON GC AN US SO CP".split(" "),l={PW:"White Player",WR:"White Rank",WT:"White Team",PB:"Black Player",BR:"Black Rank",BT:"Black Team",HA:"Handicap",KM:"Komi",RU:"Rules",TM:"Timing",OT:"Overtime",GN:"Game Name",EV:"Event",PC:"Place",RO:"Round",DT:"Date",RE:"Result",
ON:"Opening",GC:"Comments",AN:"Annotator",US:"Recorder",SO:"Source",CP:"Copyright"};h.appendChild(function(){var b=document.createElement("input");b.type="button";b.value="Info";b.title="Show/hide game info";b.onclick=function(){c.style.display="none"===c.style.display&&c.firstChild?"table":"none";a.style.display="none"};return b}());h.appendChild(function(){var b=document.createElement("input");b.type="button";b.value="Edit Info";b.title="Edit game info";b.onclick=function(){a.style.display="none"===
a.style.display?"table":"none";c.style.display="none"};return b}());h.appendChild(function(){var a=document.createElement("input");a.type="button";a.value="Comment";a.title="Edit comment";a.onclick=function(){"none"===p.style.display?(b.style.display="none",c.style.display="none",p.value=k.getCurrent().comment,p.style.display="block"):(p.style.display="none",b.style.display="block")};return a}());h.appendChild(c);h.appendChild(a);n.C=document.createTextNode("");h.appendChild(b);b.appendChild(n.C);
h.appendChild(p);p.onblur=function(){k.setComment(p.value)};p.addEventListener("keydown",function(b){b=b||window.event;b.stopPropagation()});k.addListener(f);f({navChange:!0,gameInfo:k.getGameInfo()});a.style.display="none"};
besogo.makeControlPanel=function(h,k){function f(g){function f(a){a%2?(d.setAttribute("fill","black"),e.setAttribute("fill",besogo.BLUE),b.title="Variants: child/[sibling]"):(d.setAttribute("fill",besogo.BLUE),e.setAttribute("fill",besogo.RED),b.title="Variants: [child]/sibling");2<=a?(l.setAttribute("visibility","visible"),p.title="Variants: show/[hide]"):(l.setAttribute("visibility","hidden"),p.title="Variants: [show]/hide")}function q(b,a){var d;for(d=0;d<b.length;d++)b[d].setAttribute("fill",
a)}void 0!==g.variantStyle&&f(g.variantStyle);if(g.navChange||g.treeChange)g=k.getCurrent(),g.parent?(q(n,"black"),1<g.parent.children.length?q(a,"black"):q(a,besogo.GREY)):(q(n,besogo.GREY),q(a,besogo.GREY)),g.children.length?q(c,"black"):q(c,besogo.GREY)}function m(){return besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100"})}var n=[],c=[],a=[],b,p,d,e,l;(function(){function b(a,d,e){var c=document.createElement("button"),g=m();d=besogo.svgEl("polygon",{points:d,stroke:"none",
fill:"black"});c.title=a;c.onclick=e;c.appendChild(g);g.appendChild(d);h.appendChild(c);return d}n.push(b("First node","5,10 5,90 25,90 25,50 95,90 95,10 25,50 25,10",function(){k.prevNode(-1)}));n.push(b("Jump back","95,10 50,50 50,10 5,50 50,90 50,50 95,90",function(){k.prevNode(10)}));n.push(b("Previous node","85,10 85,90 15,50",function(){k.prevNode(1)}));c.push(b("Next node","15,10 15,90 85,50",function(){k.nextNode(1)}));c.push(b("Jump forward","5,10 50,50 50,10 95,50 50,90 50,50 5,90",function(){k.nextNode(10)}));
c.push(b("Last node","95,10 95,90 75,90 75,50 5,90 5,10 75,50 75,10",function(){k.nextNode(-1)}));a.push(b("Previous sibling","10,85 90,85 50,15",function(){k.nextSibling(-1)}));a.push(b("Next sibling","10,15 90,15 50,85",function(){k.nextSibling(1)}))})();(function(){var a,c;b=document.createElement("button");b.onclick=function(){k.toggleVariantStyle(!1)};h.appendChild(b);a=m();b.appendChild(a);c=besogo.svgEl("path",{d:"m75,25h-50l50,50",stroke:"black","stroke-width":5,fill:"none"});a.appendChild(c);
d=besogo.svgEl("circle",{cx:25,cy:25,r:20,stroke:"none"});a.appendChild(d);e=besogo.svgEl("circle",{cx:75,cy:25,r:20,stroke:"none"});a.appendChild(e);c=besogo.svgEl("circle",{cx:75,cy:75,r:20,fill:besogo.RED,stroke:"none"});a.appendChild(c);p=document.createElement("button");p.onclick=function(){k.toggleVariantStyle(!0)};h.appendChild(p);a=m();p.appendChild(a);a.appendChild(besogo.svgLabel(50,50,besogo.RED,"A"));l=besogo.svgCross(50,50,"black");a.appendChild(l);c=document.createElement("button");
c.onclick=function(){k.toggleCoordStyle()};c.title="Toggle coordinates";h.appendChild(c);a=m();c.appendChild(a);a.appendChild(besogo.svgLabel(50,50,"black","\u56db4"))})();k.addListener(f);f({navChange:!0,variantStyle:k.getVariantStyle()})};
(function(){function h(f){return"ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt((f-1)%25)}function k(f){var k="";20<=f?k="\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".charAt(f/10-1)+"\u5341":10<=f&&(k="\u5341");f%10&&(k+="\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".charAt((f-1)%10));return k}besogo.coord={};besogo.coord.none=function(f,k){return!1};besogo.coord.western=function(f,k){var n={x:[],y:[]},c;for(c=1;c<=f;c++)n.x[c]=h(c);for(c=1;c<=k;c++)n.y[c]=k-c+1+"";return n};besogo.coord.numeric=
function(f,k){var h={x:[],y:[]},c;for(c=1;c<=f;c++)h.x[c]=c+"";for(c=1;c<=k;c++)h.y[c]=c+"";return h};besogo.coord.corner=function(f,k){var n={x:[],y:[]},c;for(c=1;c<=f;c++)n.x[c]=c<f/2+1?h(c):f-c+1+"";for(c=1;c<=k;c++)n.y[c]=k-c+1+"",n.y[c]=c>k/2?h(k-c+1):c+"";return n};besogo.coord.eastcor=function(f,h){var n={x:[],y:[]},c;for(c=1;c<=f;c++)n.x[c]=c<f/2+1?k(c):f-c+1+"";for(c=1;c<=h;c++)n.y[c]=h-c+1+"",n.y[c]=c>h/2?k(h-c+1):c+"";return n};besogo.coord.eastern=function(f,h){var n={x:[],y:[]},c;for(c=
1;c<=f;c++)n.x[c]=c+"";for(c=1;c<=h;c++)n.y[c]=k(c);return n}})();
besogo.makeEditor=function(h,k){function f(a){"string"===typeof a&&(u=(a=a.replace(/\s/g," ").trim())||"1",g="label",b({tool:g,label:u}))}function m(a,e,c){var l,g=d.children;for(c=0;c<g.length;c++)if((l=g[c].move)&&l.x===a&&l.y===e)return d=g[c],b({navChange:!0}),!0;return!1}function n(a,e,c,l){var g;d.isMutable("move")&&d.parent?d.playMove(a,e,c,l)&&b({stoneChange:!0}):(g=d.makeChild(),g.playMove(a,e,c,l)&&(d.addChild(g),d=g,b({treeChange:!0,navChange:!0,stoneChange:!0})))}function c(a,e,c){var g;
if(c===d.getStone(a,e))if(0!==c)c=0;else return;d.isMutable("setup")?d.placeSetup(a,e,c)&&b({stoneChange:!0}):(g=d.makeChild(),g.placeSetup(a,e,c)&&(d.addChild(g),d=g,b({treeChange:!0,navChange:!0,stoneChange:!0})))}function a(a,e,c){if(c===d.getMarkup(a,e))if(0!==c)c=0;else return;d.addMarkup(a,e,c)&&("string"===typeof c&&(/^-?\d+$/.test(c)?f(""+(+c+1)):/[A-Za-z]$/.test(c)&&(a=c.charAt(c.length-1),a="z"===a?"A":"Z"===a?"a":String.fromCharCode(a.charCodeAt()+1),f(c.slice(0,c.length-1)+a))),b({markupChange:!0}))}
function b(a,b){var d;!b&&a.navChange&&(q=[]);for(d=0;d<e.length;d++)e[d](a)}var p=besogo.makeGameRoot(h,k),d=p,e=[],l="navOnly auto playB playW addB addW addE clrMark circle square triangle cross block label".split(" "),g="auto",u="1",q=[],w={},v="none numeric western eastern corner eastcor".split(" "),t="none",r=0;return{addListener:function(a){e.push(a)},click:function(b,d,e,l){switch(g){case "navOnly":m(b,d,l);break;case "auto":m(b,d,l)||l||n(b,d,0,e);break;case "playB":n(b,d,-1,e);break;case "playW":n(b,
d,1,e);break;case "addB":c(b,d,-1);break;case "addW":c(b,d,1);break;case "addE":c(b,d,0);break;case "clrMark":a(b,d,0);break;case "circle":a(b,d,1);break;case "square":a(b,d,2);break;case "triangle":a(b,d,3);break;case "cross":a(b,d,4);break;case "block":a(b,d,5);break;case "label":a(b,d,u)}},nextNode:function(a){if(0===d.children.length)return!1;for(;0<d.children.length&&0!==a;)d=q.length?q.pop():d.children[0],a--;b({navChange:!0},!0)},prevNode:function(a){if(null===d.parent)return!1;for(;d.parent&&
0!==a;)q.push(d),d=d.parent,a--;b({navChange:!0},!0)},nextSibling:function(a){var e,c;d.parent&&(e=d.parent.children,1!==e.length&&(c=e.indexOf(d),c=(c+a)%e.length,0>c&&(c+=e.length),d=e[c],b({navChange:!0})))},toggleCoordStyle:function(){t=v[(v.indexOf(t)+1)%v.length];b({coord:t})},getCoordStyle:function(){return t},setCoordStyle:function(a){besogo.coord[a]&&(t=a,b({coord:a}))},toggleVariantStyle:function(a){var d=r%2,e=r-d;a?e=(e+2)%4:d=(d+1)%2;r=d+e;b({variantStyle:r,markupChange:!0})},getVariantStyle:function(){return r},
setVariantStyle:function(a){if(0===a||1===a||2===a||3===a)r=a,b({variantStyle:r,markupChange:!0})},getGameInfo:function(){return w},setGameInfo:function(a,d){d?w[d]=a:w=a;b({gameInfo:w})},setComment:function(a){a=a.trim();a=a.replace(/\r\n/g,"\n").replace(/\n\r/g,"\n").replace(/\r/g,"\n");a.replace(/\f\t\v\u0085\u00a0/g," ");d.comment=a;b({comment:a})},getTool:function(){return g},setTool:function(a){return"label"===a&&a===g?(/^-?\d+$/.test(u)?f("A"):f("1"),!0):-1!==l.indexOf(a)&&g!==a?(g=a,b({tool:g,
label:u}),!0):!1},getLabel:function(){return u},setLabel:f,getVariants:function(){return 2<=r?[]:1===r?d.parent?d.parent.children:[]:d.children},getCurrent:function(){return d},setCurrent:function(a){d!==a&&(d=a,b({navChange:!0}))},cutCurrent:function(){var a=d.parent;"navOnly"!==g&&a&&!0===confirm("Delete this branch?")&&(a.removeChild(d),d=a,b({treeChange:!0,navChange:!0}))},getRoot:function(){return p},loadRoot:function(a){d=p=a;b({treeChange:!0,navChange:!0,stoneChange:!0})}}};
besogo.makeFilePanel=function(h,k){function f(a){var c=document.createElement("input");c.type="button";c.value=a+"x"+a;"?"===a?(c.title="New custom size board",c.onclick=function(){var a=prompt("Enter custom size for new board\nEverything not saved will be lost","19:19");a&&(a=besogo.parseSize(a),k.loadRoot(besogo.makeGameRoot(a.x,a.y)),k.setGameInfo({}))}):(c.title="New "+a+"x"+a+" board",c.onclick=function(){confirm(c.title+"?\nEverything not saved will be lost")&&(k.loadRoot(besogo.makeGameRoot(a,
a)),k.setGameInfo({}))});h.appendChild(c)}function m(){var a=document.createElement("input");a.type="file";a.style.display="none";a.onchange=n;return a}function n(a){a=a.target.files[0];var f=new FileReader,d=m();h.replaceChild(d,c);c=d;f.onload=function(a){var b;try{b=besogo.parseSgf(a.target.result)}catch(d){alert("SGF parse error at "+d.at+":\n"+d.message);return}besogo.loadSgf(b,k)};confirm("Load '"+a.name+"'?\nEverything not saved will be lost")&&f.readAsText(a)}var c,a;f(9);f(13);f(19);f("?");
c=m();h.appendChild(c);a=document.createElement("input");a.type="button";a.value="Open";a.title="Import SGF";a.onclick=function(){c.click()};h.appendChild(a);a=document.createElement("input");a.type="button";a.value="Save";a.title="Export SGF";a.onclick=function(){var a=prompt("Save file as","export.sgf");if(a){var c=besogo.composeSgf(k),d=document.createElement("a"),c=new Blob([c],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"});d.download=a;d.href=URL.createObjectURL(c);d.style.display="none";
h.appendChild(d);d.click();h.removeChild(d)}};h.appendChild(a)};
besogo.makeGameRoot=function(h,k){function f(a,b){a.parent=b;a.children=[];a.move=null;a.setupStones=[];a.markup=[];a.comment=""}function m(a,b,c,d,e){var l=[];if(!n(a,b,c,d,l))for(b=0;b<l.length;b++)a["board"+l[b].x+"-"+l[b].y]=0,e.push(l[b])}function n(a,b,c,d,e){var l;if(1>b||1>c||b>h||c>k||a.getStone(b,c)===d)return!1;if(!a.getStone(b,c))return!0;for(l=0;l<e.length;l++)if(e[l].x===b&&e[l].y===c)return!1;e.push({x:b,y:c});return n(a,b-1,c,d,e)||n(a,b+1,c,d,e)||n(a,b,c-1,d,e)||n(a,b,c+1,d,e)?!0:
!1}var c={nextToMove:-1,blackCaps:0,whiteCaps:0,moveNumber:0};f(c,null);c.playMove=function(a,b,c,d){var e,l=!1,g,f,q;if(!this.isMutable("move"))return!1;c||(c=this.nextToMove);if(1>a||1>b||a>h||b>k)return this.move={x:0,y:0,color:c,captures:0,overwrite:!1},this.nextToMove=-c,this.moveNumber++,!0;if(this.getStone(a,b)){if(!d)return!1;l=!0}f=Object.create(this);q=[];f["board"+a+"-"+b]=c;m(f,a-1,b,c,q);m(f,a+1,b,c,q);m(f,a,b-1,c,q);m(f,a,b+1,c,q);e=q.length;g=this.parent?this.parent.move:null;if(!d&&
g&&g.color===-c&&!1===g.overwrite&&1===g.captures&&1===e&&!f.getStone(g.x,g.y)||0===e&&(m(f,a,b,-c,q),e=-q.length,0>e&&!d))return!1;0>c*e?this.blackCaps+=Math.abs(e):this.whiteCaps+=Math.abs(e);this["board"+a+"-"+b]=c;for(d=0;d<q.length;d++)this["board"+q[d].x+"-"+q[d].y]=0;this.move={x:a,y:b,color:c,captures:e,overwrite:l};this.nextToMove=-c;this.moveNumber++;return!0};c.placeSetup=function(a,b,c){var d=this.parent&&this.parent.getStone(a,b)||0;if(1>a||1>b||a>h||b>k||!this.isMutable("setup")||this.getStone(a,
b)===c)return!1;this["board"+a+"-"+b]=c;this.setupStones[(a-1)*k+(b-1)]=c-d;return!0};c.addMarkup=function(a,b,c){if(1>a||1>b||a>h||b>k||this.getMarkup(a,b)===c)return!1;this.markup[(a-1)*k+(b-1)]=c;return!0};c.getStone=function(a,b){return this["board"+a+"-"+b]||0};c.getSetup=function(a,b){if(this.setupStones[(a-1)*k+(b-1)])switch(this.getStone(a,b)){case 0:return"AE";case -1:return"AB";case 1:return"AW"}else return!1};c.getMarkup=function(a,b){return this.markup[(a-1)*k+(b-1)]||0};c.getType=function(){var a;
if(this.move)return"move";for(a=0;a<this.setupStones.length;a++)if(this.setupStones[a])return"setup";return"empty"};c.isMutable=function(a){return"move"===a&&"empty"===this.getType()&&0===this.children.length||"setup"===a&&"move"!==this.getType()&&0===this.children.length?!0:!1};c.getSiblings=function(){return this.parent&&this.parent.children||[]};c.makeChild=function(){var a=Object.create(this);f(a,this);return a};c.addChild=function(a){this.children.push(a)};c.removeChild=function(a){a=this.children.indexOf(a);
return-1!==a?(this.children.splice(a,1),!0):!1};c.getSize=function(){return{x:h,y:k}};return c};
besogo.loadSgf=function(h,k){function f(a,b){var c,l;for(c=0;c<a.props.length;c++){l=b;var g=a.props[c];switch(g.id){case "B":g=n(g.values[0]);l.playMove(g.x,g.y,-1,!0);break;case "W":g=n(g.values[0]);l.playMove(g.x,g.y,1,!0);break;case "AB":m(g.values,l,"placeSetup",-1);break;case "AW":m(g.values,l,"placeSetup",1);break;case "AE":m(g.values,l,"placeSetup",0);break;case "CR":m(g.values,l,"addMarkup",1);break;case "SQ":m(g.values,l,"addMarkup",2);break;case "TR":m(g.values,l,"addMarkup",3);break;case "M":case "MA":m(g.values,
l,"addMarkup",4);break;case "SL":m(g.values,l,"addMarkup",5);break;case "L":case "LB":m(g.values,l,"addMarkup","label");break;case "C":l.comment=l.comment?l.comment+("\n"+g.values.join().trim()):g.values.join().trim()}}for(c=0;c<a.children.length;c++)l=b.makeChild(),b.addChild(l),f(a.children[c],l)}function m(a,b,c,l){var g,f,k,h,m;for(g=0;g<a.length;g++)if(h=n(a[g].slice(0,2)),"label"===l)f=a[g].slice(3).replace(/\n/g," "),b[c](h.x,h.y,f);else if(":"===a[g].charAt(2))if(m=n(a[g].slice(3)),m.x===
h.x&&m.y===h.y)b[c](h.x,h.y,l);else if(m.x<h.x||m.y<h.y)b[c](h.x,h.y,l),b[c](m.x,m.y,l);else for(f=h.x;f<=m.x;f++)for(k=h.y;k<=m.y;k++)b[c](f,k,l);else b[c](h.x,h.y,l)}function n(a){return a.match(/^[A-Za-z]{2}$/)?{x:c(a.charAt(0)),y:c(a.charAt(1))}:{x:0,y:0}}function c(a){return a.match(/[A-Z]/)?a.charCodeAt(0)-65+27:a.charCodeAt(0)-97+1}var a={x:19,y:19},b;(function(b){var c="PB BR BT PW WR WT HA KM RU TM OT DT EV GN PC RO GC ON RE AN CP SO US".split(" "),e={},l,g,f;for(l=0;l<b.props.length;l++)g=
b.props[l].id,f=b.props[l].values.join().trim(),"SZ"===g?a=besogo.parseSize(f):"ST"===g?k.setVariantStyle(+f):-1!==c.indexOf(g)&&("GC"!==g&&(f=f.replace(/\n/g," ")),f&&(e[g]=f));k.setGameInfo(e)})(h);b=besogo.makeGameRoot(a.x,a.y);f(h,b);k.loadRoot(b)};
besogo.makeNamesPanel=function(h,k){function f(f){var g,h=0;f.gameInfo&&(g=(f.gameInfo.PW||"White")+" ("+(f.gameInfo.WR||"?")+")"+(f.gameInfo.WT?" "+f.gameInfo.WT:""),g=document.createTextNode(g),c.replaceChild(g,b),b=g,g=(f.gameInfo.PB||"Black")+" ("+(f.gameInfo.BR||"?")+")"+(f.gameInfo.BT?" "+f.gameInfo.BT:""),g=document.createTextNode(g),a.replaceChild(g,p),p=g);if(f.navChange||f.stoneChange)f=k.getCurrent(),f.move&&0===f.move.x&&0===f.move.y&&(h=f.move.color),m(d,(1===h?"Passed  ":"")+f.whiteCaps),
m(e,f.blackCaps+(-1===h?"  Passed":""))}function m(a,b){for(var c=document.createTextNode(b);a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c)}var n=document.createElement("div"),c=document.createElement("div"),a=document.createElement("div"),b=document.createTextNode(""),p=document.createTextNode(""),d=document.createElement("span"),e=document.createElement("span");n.className="besogo-playerInfo";c.className="besogo-whiteInfo";a.className="besogo-blackInfo";d.className="besogo-whiteCaps";
d.title="White captures";e.className="besogo-blackCaps";e.title="Black captures";c.appendChild(b);c.appendChild(d);a.appendChild(p);a.appendChild(e);n.appendChild(c);n.appendChild(a);h.appendChild(n);k.addListener(f);f({navChange:!0,gameInfo:k.getGameInfo()})};
besogo.parseSgf=function(h){function k(a){throw{name:"Syntax Error",message:a,at:p,text:h};}function f(a){a&&a!==d&&k("Expected '"+a+"' instead of '"+d+"'");p++;return d=h.charAt(p)}function m(){for(;d&&" ">=d;)f()}function n(){return"\n"===d?("\r"===h.charAt(p+1)&&f(),!0):"\r"===d?("\n"===h.charAt(p+1)&&f(),!0):!1}function c(){var b,l,g;f("(");m();";"!==d&&k("Sub-tree missing root");b=a();m();for(l=b;";"===d;)g=a(),l.children.push(g),l=g,m();for(;"("===d;)g=c(),l.children.push(g),m();f(")");return b}
function a(){var a,c={props:[],children:[]};f(";");for(m();d&&";"!==d&&"("!==d&&")"!==d;){for(a={id:"",values:[]};d&&/[A-Za-z]/.test(d);)/[A-Z]/.test(d)&&(a.id+=d),f();a.id||k("Missing property ID");for(m();"["===d;)a.values.push(b()),m();0===a.values.length&&k("Missing property values");c.props.push(a);m()}return c}function b(){var a="";for(f("[");d&&"]"!==d;)"\\"===d?(f("\\"),n()||(a=" ">=d?a+" ":a+d)):a=n()?a+"\n":" ">=d?a+" ":a+d,f();f("]");return a}for(var p=0,d=h.charAt(p);d&&"("!==d;)f();return c()};
besogo.composeSgf=function(h){function k(a){var b=";",c=a.children;if(!a.parent){var d="FF[4]GM[1]CA[UTF-8]AP[besogo:"+besogo.VERSION+"]",e=a.getSize().x,l=a.getSize().y,g=h.getGameInfo(),u=!1,q,d=(e===l?d+("SZ["+e+"]"):d+("SZ["+e+":"+l+"]"))+("ST["+h.getVariantStyle()+"]\n");for(q in g)g.hasOwnProperty(q)&&g[q]&&(d+=q+"["+m(g[q])+"]",u=!0);b+=d+(u?"\n":"")}q=b;b="";if("move"===a.getType())e=a.move,b+=1===e.color?"W":"B",b+="["+n(e.x,e.y)+"]";else if("setup"===a.getType()){d={AB:[],AW:[],AE:[]};for(l=
1;l<=a.getSize().x;l++)for(g=1;g<=a.getSize().y;g++)(e=a.getSetup(l,g))&&d[e].push({x:l,y:g});b+=f(d)}d={CR:[],SQ:[],TR:[],MA:[],SL:[],LB:[]};for(l=1;l<=a.getSize().x;l++)for(g=1;g<=a.getSize().y;g++)if(e=a.getMarkup(l,g))"string"===typeof e?d.LB.push({x:l,y:g,label:e}):(e=["CR","SQ","TR","MA","SL"][e-1],d[e].push({x:l,y:g}));b+=f(d);a.comment&&(b=b+(b?"\n":"")+("C["+m(a.comment)+"]"));b=q+b;if(1===c.length)b+="\n"+k(c[0]);else if(1<c.length)for(a=0;a<c.length;a++)b+="\n("+k(c[a])+")";return b}function f(a){var b=
"",c,d,e;for(c in a)if(a.hasOwnProperty(c)&&(d=a[c],0<d.length))for(b+=c,e=0;e<d.length;e++)b+="["+n(d[e].x,d[e].y),d[e].label&&(b+=":"+m(d[e].label)),b+="]";return b}function m(a){a=a.replace(/\\/g,"\\\\");return a.replace(/\]/g,"\\]")}function n(a,b){return 0===a||0===b?"":c(a)+c(b)}function c(a){return 26<a?String.fromCharCode(65+a-27):String.fromCharCode(97+a-1)}return"("+k(h.getRoot())+")"};
(function(){besogo.RED="#be0119";besogo.LRED="#ff474c";besogo.BLUE="#0165fc";besogo.PURP="#9a0eea";besogo.GREY="#929591";besogo.GOLD="#dbb40c";besogo.TURQ="#06c2ac";besogo.BLACK_STONES=4;besogo.WHITE_STONES=11;besogo.svgEl=function(h,k){var f,m=document.createElementNS("http://www.w3.org/2000/svg",h);for(f in k||{})k.hasOwnProperty(f)&&m.setAttribute(f,k[f]);return m};besogo.svgShadowGroup=function(){var h=besogo.svgEl("g"),k=besogo.svgEl("filter",{id:"blur"}),f=besogo.svgEl("feGaussianBlur",{"in":"SourceGraphic",
stdDeviation:"2"});k.appendChild(f);h.appendChild(k);return h};besogo.svgShadow=function(h,k){return besogo.svgEl("circle",{cx:h,cy:k,r:43,stroke:"none",fill:"black",opacity:.32,filter:"url(#blur)"})};besogo.realStone=function(h,k,f,m){f=0>f?"black"+m%besogo.BLACK_STONES:"white"+m%besogo.WHITE_STONES;f="img/"+f+".png";h=besogo.svgEl("image",{x:h-44,y:k-44,height:88,width:88});h.setAttributeNS("http://www.w3.org/1999/xlink","href",f);return h};besogo.svgStone=function(h,k,f){var m="besogo-svg-greyStone";
-1===f?m="besogo-svg-blackStone":1===f&&(m="besogo-svg-whiteStone");return besogo.svgEl("circle",{cx:h,cy:k,r:42,"class":m})};besogo.svgCircle=function(h,k,f){return besogo.svgEl("circle",{cx:h,cy:k,r:27,stroke:f,"stroke-width":8,fill:"none"})};besogo.svgSquare=function(h,k,f){return besogo.svgEl("rect",{x:h-23,y:k-23,width:46,height:46,stroke:f,"stroke-width":8,fill:"none"})};besogo.svgTriangle=function(h,k,f){return besogo.svgEl("polygon",{points:""+h+","+(k-30)+" "+(h-26)+","+(k+15)+" "+(h+26)+
","+(k+15),stroke:f,"stroke-width":8,fill:"none"})};besogo.svgCross=function(h,k,f){return besogo.svgEl("path",{d:"m"+(h-24)+","+(k-24)+"l48,48m0,-48l-48,48",stroke:f,"stroke-width":8,fill:"none"})};besogo.svgPlus=function(h,k,f){return besogo.svgEl("path",{d:"m"+h+","+(k-28)+"v56m-28,-28h56",stroke:f,"stroke-width":8,fill:"none"})};besogo.svgBlock=function(h,k,f){return besogo.svgEl("rect",{x:h-18,y:k-18,width:36,height:36,stroke:"none","stroke-width":8,fill:f})};besogo.svgLabel=function(h,k,f,m){var n;
3<m.length&&(m=m.slice(0,2)+"\u2026");switch(m.length){case 1:n=72;break;case 2:n=56;break;case 3:n=36}h=besogo.svgEl("text",{x:h,y:k,dy:".65ex","font-size":n,"text-anchor":"middle","font-family":"Helvetica, Arial, sans-serif",fill:f});h.appendChild(document.createTextNode(m));return h}})();
besogo.makeToolPanel=function(h,k){function f(a,c){var d=document.createElement("button"),f=besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"-55 -55 110 110"}),q=besogo.svgEl("rect",{x:-50,y:-50,width:100,height:100,fill:"none","stroke-width":8,stroke:besogo.GOLD,rx:20,ry:20,visibility:"hidden"});h.appendChild(d);d.appendChild(f);d.onclick=function(){k.setTool(a)};d.title=c;b[a]=q;f.appendChild(q);return f}function m(c){var d;c.label&&(a.value=c.label);if(c.tool)for(d in b)b.hasOwnProperty(d)&&
(c.tool===d?b[d].setAttribute("visibility","visible"):b[d].setAttribute("visibility","hidden"))}var n,c,a,b={},p=document.createElement("input"),d=document.createElement("input");c=f("auto","Auto-play/nav");c.appendChild(function(a,b){var c=besogo.svgEl("g");c.appendChild(besogo.svgEl("path",{d:"m"+a+","+(b-44)+" a44 44 0 0 1 0,88z",stroke:"none",fill:"black"}));c.appendChild(besogo.svgEl("path",{d:"m"+a+","+(b+44)+"a44 44 0 0 1 0,-88a22 22 0 0 1 0,44z",stroke:"none",fill:"white"}));c.appendChild(besogo.svgEl("circle",
{cx:a,cy:b+22,r:22,stroke:"none",fill:"black"}));return c}(0,0));c=f("playB","Play black");c.appendChild(besogo.svgStone(0,0,-1));c=f("playW","Play white");c.appendChild(besogo.svgStone(0,0,1));c=f("addB","Set black");n=besogo.svgEl("g");n.appendChild(besogo.svgStone(0,0,-1));n.appendChild(besogo.svgPlus(0,0,besogo.RED));c.appendChild(n);c=f("addW","Set white");n=besogo.svgEl("g");n.appendChild(besogo.svgStone(0,0,1));n.appendChild(besogo.svgPlus(0,0,besogo.RED));c.appendChild(n);c=f("addE","Set empty");
n=besogo.svgEl("g");n.appendChild(besogo.svgStone(0,0));n.appendChild(besogo.svgCross(0,0,besogo.RED));c.appendChild(n);c=f("circle","Circle");c.appendChild(besogo.svgCircle(0,0,"black"));c=f("square","Square");c.appendChild(besogo.svgSquare(0,0,"black"));c=f("triangle","Triangle");c.appendChild(besogo.svgTriangle(0,0,"black"));c=f("cross","Cross");c.appendChild(besogo.svgCross(0,0,"black"));c=f("block","Block");c.appendChild(besogo.svgBlock(0,0,"black"));c=f("clrMark","Clear mark");n=besogo.svgEl("g");
n.appendChild(besogo.svgTriangle(0,0,besogo.GREY));n.appendChild(besogo.svgCross(0,0,besogo.RED));c.appendChild(n);c=f("label","Label");c.appendChild(besogo.svgLabel(0,0,"black","A1"));a=document.createElement("input");a.type="text";a.title="Next label";a.onblur=function(){k.setLabel(a.value)};a.addEventListener("keydown",function(a){a=a||window.event;a.stopPropagation()});h.appendChild(a);p.type="button";p.value="Pass";p.title="Pass move";p.onclick=function(){var a=k.getTool();"navOnly"!==a&&"auto"!==
a&&"playB"!==a&&"playW"!==a&&k.setTool("auto");k.click(0,0,!1)};h.appendChild(p);d.type="button";d.value="Cut";d.title="Remove branch";d.onclick=function(){k.cutCurrent()};h.appendChild(d);k.addListener(m);m({label:k.getLabel(),tool:k.getTool()})};
besogo.makeTreePanel=function(h,k){function f(a){var b=h.clientWidth,c=h.clientHeight,d=h.scrollTop,e=h.scrollLeft,f=.25*(a.getAttribute("x")-5),k=.25*(a.getAttribute("y")-5);f<e?h.scrollLeft=f:f+30>e+b&&(h.scrollLeft=f+30-b);k<d?h.scrollTop=k:k+30>d+c&&(h.scrollTop=k+30-c);a.setAttribute("opacity",1);a.onmouseover=null;a.onmouseout=null;g.appendChild(a);u=a}function m(a){a.setAttribute("opacity",0);a.onmouseover=function(){a.setAttribute("opacity",.5)};a.onmouseout=function(){a.setAttribute("opacity",
0)};e.appendChild(a)}function n(){var a=k.getCurrent(),b=k.getRoot(),m=[],n=e,p=besogo.svgEl("rect",{height:"100%",width:"100%","class":"besogo-svg-board"});e=besogo.svgEl("svg");g=besogo.svgEl("g");l=besogo.svgEl("g");e.appendChild(p);e.appendChild(g);e.appendChild(l);b=c(b,0,0,m);l.appendChild(d(b,"black"));b=120*m.length;m=120*Math.max.apply(Math,m);e.setAttribute("viewBox","0 0 "+b+" "+m);e.setAttribute("height",.25*m);e.setAttribute("width",.25*b);n?h.replaceChild(e,n):h.appendChild(e);f(a.navTreeMarker)}
function c(f,g,h,k){var m=f.children,n,u,y;if(0===m.length)u="m"+(120*g+60)+","+(120*h+60);else for(n=k[g+1]||0,n=n<h?h:n,h<n-1&&(h=n-1),u=c(m[0],g+1,n,k)+p(g,h,k),y=1;y<m.length;y++)n=k[g+1],n=c(m[y],g+1,n,k)+p(g,h,k,n-1),l.appendChild(d(n,"black"));e.appendChild(a(f,g,h));b(f,g,h);k[g]=h+1;return u}function a(a,b,c){var d,e;switch(a.getType()){case "move":e=a.move.color;d=besogo.svgEl("g");d.appendChild(besogo.svgStone(120*b+60,120*c+60,e));d.appendChild(besogo.svgLabel(120*b+60,120*c+60,-1===e?
"white":"black",""+a.moveNumber));break;case "setup":d=besogo.svgEl("g");d.appendChild(besogo.svgStone(120*b+60,120*c+60));d.appendChild(besogo.svgPlus(120*b+60,120*c+60,besogo.RED));break;default:d=besogo.svgStone(120*b+60,120*c+60)}a.navTreeIcon=d;a.navTreeX=b;a.navTreeY=c;return d}function b(a,b,c){b=besogo.svgEl("rect",{x:120*b+60-55,y:120*c+60-55,width:110,height:110,fill:besogo.TURQ});b.onclick=function(){k.setCurrent(a)};a.navTreeMarker=b;m(b)}function p(a,b,c,d){a=c[a+1]-1;return a===b?"h-120":
a===b+1?"l-120,-120":d&&d!==b?"l-60,-60v-"+120*(a-d):"l-60,-60v-"+120*(a-b-1)+"l-60,-60"}function d(a,b){return besogo.svgEl("path",{d:a,stroke:b,"stroke-width":8,fill:"none"})}var e,l,g,u;n();k.addListener(function(b){if(b.treeChange)n();else if(b.navChange)b=k.getCurrent(),m(u),f(b.navTreeMarker);else if(b.stoneChange){var c=k.getCurrent();b=c.navTreeIcon;c=a(c,c.navTreeX,c.navTreeY);e.replaceChild(c,b)}})};
